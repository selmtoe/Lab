<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TETRIS LAB - Advanced Research</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+JP:wght@300;500;700&display=swap" rel="stylesheet">
<style>
    /* --- 高級感のあるデザイン定義 --- */
    :root {
        --bg-main: #0a0a12;
        --bg-panel: rgba(30, 30, 45, 0.7);
        --accent: #6a6aff;
        --accent-glow: rgba(106, 106, 255, 0.4);
        --text-main: #f0f0f0;
        --text-sub: #a0a0b0;
        --border: 1px solid rgba(255, 255, 255, 0.1);
        --glass: blur(12px);
    }

    body {
        background-color: var(--bg-main);
        color: var(--text-main);
        font-family: 'Noto Sans JP', sans-serif;
        margin: 0;
        overflow-x: hidden;
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(106, 106, 255, 0.15) 0%, transparent 40%),
            radial-gradient(circle at 90% 80%, rgba(0, 255, 255, 0.1) 0%, transparent 40%);
        background-attachment: fixed;
    }

    /* レイアウト */
    .container {
        display: flex;
        min-height: 100vh;
    }

    /* サイドバー */
    .sidebar {
        width: 260px;
        background: var(--bg-panel);
        backdrop-filter: var(--glass);
        border-right: var(--border);
        padding: 30px 20px;
        position: sticky;
        top: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        z-index: 100;
    }

    .logo {
        font-family: 'Orbitron', sans-serif;
        font-size: 28px;
        font-weight: 700;
        color: #fff;
        text-shadow: 0 0 15px var(--accent);
        margin-bottom: 40px;
        letter-spacing: 2px;
        cursor: pointer;
    }

    .nav-item {
        padding: 15px;
        margin-bottom: 8px;
        color: var(--text-sub);
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-family: 'Orbitron', sans-serif;
        letter-spacing: 1px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .nav-item:hover, .nav-item.active {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
        border-left: 3px solid var(--accent);
        box-shadow: 0 0 20px rgba(106, 106, 255, 0.1);
    }

    /* メインエリア */
    .main-content {
        flex: 1;
        padding: 40px;
        overflow-y: auto;
    }

    h2.section-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 32px;
        border-bottom: 2px solid var(--accent);
        padding-bottom: 10px;
        margin-bottom: 30px;
        display: inline-block;
        color: #fff;
        text-shadow: 0 0 10px var(--accent-glow);
    }

    /* カードグリッド */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
    }

    .card {
        background: var(--bg-panel);
        border: var(--border);
        border-radius: 12px;
        padding: 25px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 4px; height: 100%;
        background: var(--accent);
        opacity: 0;
        transition: 0.3s;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        border-color: var(--accent);
    }

    .card:hover::before { opacity: 1; }

    .card-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-size: 12px;
        color: var(--text-sub);
    }

    .tag {
        background: rgba(106, 106, 255, 0.2);
        color: #ccccff;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 10px;
        margin-right: 5px;
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 10px;
        line-height: 1.4;
        color: #fff;
    }

    .card-desc {
        font-size: 14px;
        color: var(--text-sub);
        margin-bottom: 20px;
        line-height: 1.6;
    }

    /* ボタン */
    .btn {
        display: inline-block;
        background: transparent;
        color: var(--accent);
        border: 1px solid var(--accent);
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 12px;
        text-decoration: none;
        transition: 0.3s;
        cursor: pointer;
        font-family: 'Orbitron', sans-serif;
    }

    .btn:hover {
        background: var(--accent);
        color: #fff;
        box-shadow: 0 0 15px var(--accent-glow);
    }

    /* 記事ビュー (詳細表示) */
    .article-view {
        background: var(--bg-panel);
        border-radius: 15px;
        padding: 40px;
        border: var(--border);
    }
    
    .article-meta {
        color: var(--text-sub);
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
    }

    .iframe-container {
        width: 100%;
        height: 80vh; /* 画面の80% */
        border: none;
        border-radius: 8px;
        background: #000;
        margin-bottom: 30px;
    }

    /* 関連記事セクション */
    .related-section {
        margin-top: 50px;
        border-top: 1px solid rgba(255,255,255,0.1);
        padding-top: 20px;
    }

    /* YouTube Timestamp Buttons */
    .timestamp-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }
    
    .ts-btn {
        background: rgba(255,255,255,0.1);
        border: none;
        color: #fff;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: 0.2s;
    }
    .ts-btn:hover { background: var(--accent); }

    /* モバイル対応 */
    @media (max-width: 768px) {
        .container { flex-direction: column; }
        .sidebar { width: 100%; height: auto; position: relative; padding: 15px; }
        .nav-item { display: inline-block; margin-right: 10px; }
        .main-content { padding: 20px; }
    }
</style>
</head>
<body>

<div class="container">
    <aside class="sidebar">
        <div class="logo" onclick="app.router('dashboard')">TETRIS LAB</div>
        <nav>
            <div class="nav-item active" onclick="app.router('dashboard')">DASHBOARD</div>
            <div class="nav-item" onclick="app.router('articles')">ARTICLES</div>
            <div class="nav-item" onclick="app.router('videos')">VIDEOS</div>
            <div class="nav-item" onclick="app.router('tetofu')">TETOFU (FUMEN)</div>
        </nav>
        
        <div style="margin-top:auto; padding-top:20px; border-top:var(--border);">
            <div class="nav-item" onclick="window.open('tools/simulator/index.html')">Simulator ↗</div>
            <div class="nav-item" onclick="window.open('tools/editor/index.html')">Fumen Editor ↗</div>
        </div>
    </aside>

    <main id="app-root" class="main-content">
        </main>
</div>

<script>
    // --- 1. データ管理 (本来は外部ファイル js/data.js 推奨) ---
    const DB = {
        articles: [
            {
                id: 'theory-resource',
                title: '対戦テトリスにおけるリソース理論：マクロ的動態分析',
                date: '2025-12-10',
                tags: ['Theory', 'Math', 'Strategy'],
                type: 'internal', // 内部記事
                contentUrl: 'articles/math.html', // 外部HTMLをiframeで呼ぶか、text本文を入れる
                description: '盤面のブロック数を「リソース」と定義し、相殺と循環のメカニズムを数学的に解明する。'
            },
            {
                id: 'practice-vs-study',
                title: '「座学」と「実技」の融合：なぜレート3200で停滞したか',
                date: '2025-12-12',
                tags: ['Column', 'Mindset'],
                type: 'external', // 外部リンク
                link: 'https://note.com/your_note_link',
                description: '2000時間の実技偏重が招いた停滞と、シミュレータ開発によるブレイクスルーの記録。'
            },
            {
                id: 'simulator-dev',
                title: '自作シミュレータ開発日誌',
                date: '2025-10-01',
                tags: ['Dev', 'Tool', 'Simulator'],
                type: 'internal_iframe', // シミュレータ自体を埋め込んで解説する記事
                iframeUrl: 'tools/simulator/index.html',
                description: 'このラボの中核となるシミュレータの動作テストと解説。'
            }
        ],
        videos: [
            {
                id: 'vid001',
                title: 'Kazu vs Amemiya - Top Rank Match Analysis',
                date: '2025-11-20',
                tags: ['Replay', 'God Match'],
                youtubeId: 'DummyID', // YoutubeのID
                timestamps: [
                    { time: 65, label: '1:05 - 驚異の凝視' },
                    { time: 180, label: '3:00 - リソース管理の極み' },
                    { time: 420, label: '7:00 - 決着の瞬間' }
                ],
                description: 'リソース理論の観点から見た、トッププレイヤーの相殺管理。'
            }
        ],
        tetofu: [
            {
                id: 'tf001',
                title: 'Iミノ上部最適化パターン',
                date: '2025-12-15',
                tags: ['Technique', 'Fumen'],
                code: 'v115@vhAAgH...', // ここにテト譜コード
                description: 'Twitterで話題になった、Iミノを無駄にしないための積み方クイズ。'
            },
            {
                id: 'tf002',
                title: '中開けREN：青エリアと赤エリア',
                date: '2025-12-14',
                tags: ['REN', 'Theory'],
                code: 'v115@vhAAgH...', 
                description: '中開けにおける「死なないための空け方」の解説譜面。'
            }
        ]
    };

    // --- 2. アプリケーションロジック ---
    const app = {
        root: document.getElementById('app-root'),
        
        // 関連記事を見つけるロジック
        findRelated: (currentTags, currentId, allItems) => {
            if(!currentTags) return [];
            return allItems
                .filter(item => item.id !== currentId) // 自分自身は除く
                .map(item => ({
                    item,
                    score: item.tags.filter(tag => currentTags.includes(tag)).length
                }))
                .filter(match => match.score > 0)
                .sort((a, b) => b.score - a.score) // 関連度順
                .slice(0, 3) // 上位3つ
                .map(match => match.item);
        },

        // ルーティング
        router: (page, id = null) => {
            // ナビゲーションのハイライト更新
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.toggle('active', el.textContent.includes(page.toUpperCase()));
            });

            window.scrollTo(0,0);
            
            switch(page) {
                case 'dashboard': app.renderDashboard(); break;
                case 'articles': 
                    if(id) app.renderArticleDetail(id);
                    else app.renderList('articles', DB.articles); 
                    break;
                case 'videos': app.renderVideoList(DB.videos); break;
                case 'tetofu': app.renderTetofuList(DB.tetofu); break;
            }
        },

        // ダッシュボード描画
        renderDashboard: () => {
            app.root.innerHTML = `<h2 class="section-title">LATEST RESEARCH</h2>`;
            const grid = document.createElement('div');
            grid.className = 'grid';

            // 各カテゴリの最新を表示
            const latest = [
                ...DB.articles.slice(0, 2).map(i => ({...i, cat:'ARTICLE', page:'articles'})),
                ...DB.videos.slice(0, 1).map(i => ({...i, cat:'VIDEO', page:'videos'})),
                ...DB.tetofu.slice(0, 1).map(i => ({...i, cat:'TETOFU', page:'tetofu'}))
            ];

            latest.forEach(item => {
                grid.innerHTML += app.createCardHtml(item);
            });
            app.root.appendChild(grid);
        },

        // リスト描画（記事用）
        renderList: (type, data) => {
            app.root.innerHTML = `<h2 class="section-title">${type.toUpperCase()} ARCHIVE</h2>`;
            const grid = document.createElement('div');
            grid.className = 'grid';
            data.forEach(item => {
                grid.innerHTML += app.createCardHtml({...item, cat: type.slice(0,-1).toUpperCase(), page: type});
            });
            app.root.appendChild(grid);
        },

        // 動画リスト描画（特別仕様）
        renderVideoList: (data) => {
            app.root.innerHTML = `<h2 class="section-title">VIDEO ANALYSIS</h2>`;
            const container = document.createElement('div');
            
            data.forEach(video => {
                const el = document.createElement('div');
                el.className = 'article-view';
                el.style.marginBottom = '30px';
                
                // YouTube Embed
                const embedUrl = `https://www.youtube.com/embed/${video.youtubeId}?enablejsapi=1`;
                
                let timestampHtml = '';
                video.timestamps.forEach(ts => {
                    timestampHtml += `<button class="ts-btn" onclick="app.seekVideo('${video.id}', ${ts.time})">▶ ${ts.label}</button>`;
                });

                el.innerHTML = `
                    <div class="card-title">${video.title}</div>
                    <div class="article-meta">
                        <span>${video.date}</span>
                        <div>${video.tags.map(t => `<span class="tag">${t}</span>`).join('')}</div>
                    </div>
                    <div class="iframe-container" style="height: 400px;">
                        <iframe id="iframe-${video.id}" src="${embedUrl}" allowfullscreen></iframe>
                    </div>
                    <div class="timestamp-container">${timestampHtml}</div>
                    <p class="card-desc" style="margin-top:15px;">${video.description}</p>
                `;
                container.appendChild(el);
            });
            app.root.appendChild(container);
        },

        // テト譜リスト描画
        renderTetofuList: (data) => {
            app.root.innerHTML = `<h2 class="section-title">TETOFU LIBRARY</h2>`;
            const grid = document.createElement('div');
            grid.className = 'grid';
            
            data.forEach(item => {
                // テト譜エディタへのリンク生成 (Base64部分のみ抽出を想定)
                // 実際はあなたのエディタのURLに合わせて調整してください
                const editorUrl = `tools/editor/index.html#${item.code}`; // 仮
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <span class="tag">FUMEN</span>
                        <span>${item.date}</span>
                    </div>
                    <div class="card-title">${item.title}</div>
                    <div style="margin-bottom:10px;">
                        ${item.tags.map(t => `<span class="tag">${t}</span>`).join('')}
                    </div>
                    <p class="card-desc">${item.description}</p>
                    <a href="${editorUrl}" target="_blank" class="btn">OPEN IN EDITOR</a>
                `;
                grid.appendChild(card);
            });
            app.root.appendChild(grid);
        },

        // 記事詳細描画
        renderArticleDetail: (id) => {
            const article = DB.articles.find(a => a.id === id);
            if(!article) return;

            // 関連記事取得
            const related = app.findRelated(article.tags, article.id, DB.articles);

            let contentHtml = '';
            if(article.type === 'internal_iframe') {
                contentHtml = `<iframe src="${article.iframeUrl}" class="iframe-container"></iframe>`;
            } else if (article.type === 'external') {
                window.open(article.link, '_blank');
                app.router('articles'); // 戻る
                return;
            } else {
                // 通常の内部記事テキストなどの場合
                contentHtml = `<div style="line-height:1.8; color:#ddd;">${article.description}<br><br>(ここに詳細な本文が入ります。Markdownパーサーを入れるとより良くなります)</div>`;
            }

            // 関連記事HTML生成
            let relatedHtml = '';
            if(related.length > 0) {
                relatedHtml = `<div class="related-section"><h3 style="color:#fff; font-family:'Orbitron'">RELATED NOTES</h3><div class="grid">`;
                related.forEach(r => {
                    relatedHtml += app.createCardHtml({...r, cat:'ARTICLE', page:'articles'});
                });
                relatedHtml += `</div></div>`;
            }

            app.root.innerHTML = `
                <button onclick="app.router('articles')" class="btn" style="margin-bottom:20px;">← BACK TO LIST</button>
                <div class="article-view">
                    <h1 style="font-size:2rem; margin-bottom:10px; color:#fff;">${article.title}</h1>
                    <div class="article-meta">
                        <span>${article.date}</span>
                        <div>${article.tags.map(t => `<span class="tag">${t}</span>`).join('')}</div>
                    </div>
                    ${contentHtml}
                    ${relatedHtml}
                </div>
            `;
        },

        // カードHTML生成ヘルパー
        createCardHtml: (item) => {
            // 内部記事ならonclickでルーターを呼ぶ、外部ならtarget blank
            let action = '';
            if (item.type === 'external') {
                action = `href="${item.link}" target="_blank"`;
            } else if (item.page === 'videos' || item.page === 'tetofu') {
                action = `onclick="app.router('${item.page}')"`; // 一覧へ飛ぶ
            } else {
                action = `onclick="app.router('${item.page}', '${item.id}')"`;
            }

            return `
                <div class="card" style="cursor:pointer;" ${item.type !== 'external' ? `onclick="app.router('${item.page}', '${item.id || ''}')"` : ''}>
                    <div class="card-header">
                        <span class="tag">${item.cat}</span>
                        <span>${item.date}</span>
                    </div>
                    <div class="card-title">${item.title}</div>
                    <div style="margin-bottom:10px;">
                        ${item.tags.map(t => `<span class="tag">${t}</span>`).join('')}
                    </div>
                    <p class="card-desc">${item.description}</p>
                    <a ${action} class="btn">VIEW DETAIL</a>
                </div>
            `;
        },

        // 動画シーク用
        seekVideo: (id, time) => {
            const iframe = document.getElementById(`iframe-${id}`);
            if(iframe) {
                iframe.contentWindow.postMessage(JSON.stringify({
                    event: 'command',
                    func: 'seekTo',
                    args: [time, true]
                }), '*');
            }
        }
    };

    // 初期化
    app.router('dashboard');

</script>
</body>
</html>
