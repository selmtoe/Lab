<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TETRIS LAB</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://www.youtube.com/iframe_api"></script>

<style>
    :root {
        --bg-color: #f9f9f9;
        --surface-color: #ffffff;
        --text-main: #222222;
        --text-muted: #737373;
        --border-color: #e5e5e5;
        --accent-color: #2cb696;
        --link-color: #1a73e8;
        --font-main: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
        --max-width: 1200px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
        background-color: var(--bg-color);
        color: var(--text-main);
        font-family: var(--font-main);
        line-height: 1.8;
        letter-spacing: 0.03em;
        -webkit-font-smoothing: antialiased;
    }

    /* Header Navigation */
    header {
        background-color: var(--surface-color);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    .header-inner {
        max-width: var(--max-width);
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 64px;
    }
    .logo {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-main);
        text-decoration: none;
        cursor: pointer;
        margin-right: 20px;
        flex-shrink: 0;
    }
    .nav-wrapper {
        display: flex;
        align-items: center;
        flex-grow: 1;
        justify-content: space-between;
    }
    .nav-links {
        display: flex;
        gap: 20px;
    }
    .nav-item {
        color: var(--text-muted);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: color 0.2s;
        white-space: nowrap;
    }
    .nav-item:hover, .nav-item.active {
        color: var(--accent-color);
    }
    
    /* Search Bar */
    .search-box {
        position: relative;
        margin-left: 20px;
        max-width: 200px;
        width: 100%;
    }
    .search-input {
        width: 100%;
        padding: 6px 12px 6px 32px;
        border-radius: 20px;
        border: 1px solid var(--border-color);
        background: var(--bg-color);
        font-size: 13px;
        outline: none;
        transition: 0.2s;
    }
    .search-input:focus { border-color: var(--accent-color); background: #fff; }
    .search-icon {
        position: absolute; left: 10px; top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted); font-size: 12px; pointer-events: none;
    }

    /* Main Container */
    .container {
        max-width: var(--max-width);
        margin: 40px auto 80px;
        padding: 0 20px;
        min-height: calc(100vh - 184px);
        animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .section-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 24px;
        color: var(--text-main);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 12px;
    }

    /* Cards */
    .list-container {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
    .card {
        background: var(--surface-color);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        cursor: pointer;
        transition: box-shadow 0.2s, transform 0.2s;
        text-decoration: none;
        color: inherit;
        display: block;
    }
    .card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        transform: translateY(-2px);
    }
    .card-meta {
        font-size: 13px;
        color: var(--text-muted);
        margin-bottom: 8px;
        display: flex;
        gap: 12px;
        align-items: center;
    }
    .card-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 8px;
        line-height: 1.4;
        /* è‰²æŒ‡å®šã‚’å‰Šé™¤ã—ã€è¦ªè¦ç´ (é»’)ã‚’ç¶™æ‰¿ */
    }
    .card-desc {
        font-size: 15px;
        color: var(--text-muted);
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* Tags */
    .tag {
        display: inline-block;
        padding: 2px 10px;
        font-size: 12px;
        background-color: #f0f0f0;
        color: var(--text-muted);
        border-radius: 100px;
        margin: 0 6px 6px 0;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
    }
    .tag:hover, .tag.active {
        background-color: var(--accent-color);
        color: #fff;
    }

    /* Article Reader */
    .article-header { margin-bottom: 24px; }
    .article-title { font-size: 32px; font-weight: 700; line-height: 1.4; margin: 16px 0; }
    .article-body { font-size: 16px; color: var(--text-main); }
    .article-body h2 { font-size: 24px; margin: 40px 0 16px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; }
    .article-body h3 { font-size: 20px; margin: 32px 0 16px; }
    .article-body p { margin-bottom: 24px; }
    .article-body iframe { width: 100%; height: 500px; border: 1px solid var(--border-color); border-radius: 8px; margin: 24px 0; background: var(--surface-color); }
    .article-body a { color: var(--accent-color); text-decoration: underline; }

    /* Video Detail Layout (Split Screen) */
    .video-detail-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 32px;
    }
    @media (min-width: 900px) {
        .video-detail-container {
            grid-template-columns: 2.5fr 1fr;
            align-items: start;
        }
        .video-sticky-area {
            position: sticky;
            top: 84px; /* header height + margin */
        }
    }

    .video-wrapper {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        border-radius: 8px;
        overflow: hidden;
        background: #000;
        margin-bottom: 16px;
    }
    .video-wrapper iframe, .video-wrapper div { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

    /* Video Controls */
    .video-controls {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }
    .rate-btn {
        padding: 4px 12px;
        font-size: 13px;
        border: 1px solid var(--border-color);
        background: var(--surface-color);
        border-radius: 4px;
        cursor: pointer;
    }
    .rate-btn:hover, .rate-btn.active {
        background: var(--text-muted);
        color: #fff;
        border-color: var(--text-muted);
    }

    /* Timestamps in Text */
    .ts-link {
        color: var(--accent-color);
        font-weight: 700;
        cursor: pointer;
        font-family: monospace;
        background: rgba(44, 182, 150, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 4px;
        text-decoration: none;
        display: inline-block;
    }
    .ts-link:hover {
        background: var(--accent-color);
        color: white;
    }
    
    /* Timestamps in Preview Card */
    .preview-ts-list {
        margin-top: 12px;
        background: #fcfcfc;
        border-radius: 8px;
        padding: 12px;
        border: 1px solid var(--border-color);
    }
    .preview-ts-item {
        display: flex;
        align-items: baseline;
        font-size: 13px;
        color: var(--text-muted);
        margin-bottom: 6px;
        gap: 8px;
        cursor: pointer; /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ */
        padding: 2px 4px;
        border-radius: 4px;
    }
    .preview-ts-item:hover {
        background: rgba(0,0,0,0.03);
    }
    .preview-ts-item:last-child { margin-bottom: 0; }
    .ts-badge {
        font-family: monospace;
        color: var(--accent-color);
        font-weight: 500;
        flex-shrink: 0;
    }

    /* Utility */
    .btn-outline {
        display: inline-block;
        padding: 8px 16px; border: 1px solid var(--border-color);
        border-radius: 100px; color: var(--text-main); text-decoration: none; font-size: 14px;
        transition: 0.2s; cursor: pointer;
        background: var(--surface-color);
    }
    .btn-outline:hover { background: #f0f0f0; border-color: #dcdcdc; }

    /* Mobile Responsive */
    @media (max-width: 600px) {
        .header-inner { padding: 0 16px; height: auto; flex-direction: column; padding-bottom: 12px; }
        .logo { margin: 12px 0; }
        .nav-wrapper { width: 100%; flex-direction: column; gap: 12px; }
        .nav-links { width: 100%; justify-content: center; gap: 16px; font-size: 13px; }
        .search-box { margin: 0; max-width: 100%; }
        .container { margin-top: 20px; }
    }
</style>
</head>
<body>

<header>
    <div class="header-inner">
        <div class="logo" onclick="router('dashboard')">TETRIS LAB</div>
        <div class="nav-wrapper">
            <nav class="nav-links">
                <a class="nav-item active" onclick="router('dashboard')">Home</a>
                <a class="nav-item" onclick="router('articles')">Articles</a>
                <a class="nav-item" onclick="router('videos')">Videos</a>
                <a class="nav-item" onclick="router('tetofu')">Tetofu</a>
                <a class="nav-item" onclick="router('tags')">Tags</a>
            </nav>
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" placeholder="Search..." onkeydown="handleSearch(event)">
            </div>
        </div>
    </div>
</header>

<main id="main-view" class="container"></main>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
    // æä¾›ã•ã‚ŒãŸå‹•ç”»ãƒ‡ãƒ¼ã‚¿
    window.LAB_VIDEOS = [
        {
            id: 'top-player-analysis-01',
            date: '2025-11-20',
            title: 'ä¸–ç•Œå¤§ä¼šæ±ºå‹: æ˜ã‚Šã¨ç›¸æ®ºç®¡ç†ã®å®Œå…¨åˆ†æ',
            youtubeId: 'dQw4w9WgXcQ', // å®Ÿéš›ã®å‹•ç”»IDã‚’å…¥ã‚Œã¦ãã ã•ã„
            tags: ['å¤§ä¼š', 'ãƒˆãƒƒãƒ—ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼', 'è§£èª¬'],
            description: 'ä¸–ç•Œå¤§ä¼šæ±ºå‹ã®ç¬¬3è©¦åˆã€ä¸åˆ©ãªçŠ¶æ³ã‹ã‚‰ã®é€†è»¢åŠ‡ã‚’å¾¹åº•çš„ã«åˆ†æã—ã¾ã™ã€‚ç‰¹ã«ä¸­ç›¤ã®æ˜ã‚Šã®åˆ¤æ–­ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚',
            content: `
### è©¦åˆã®æ¦‚è¦
ã“ã®è©¦åˆã¯ã€ãŠäº’ã„ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šã‚Šåˆã†æ¶ˆè€—æˆ¦ã¨ãªã‚Šã¾ã—ãŸã€‚ã€‡ã€‡é¸æ‰‹ã®ç²˜ã‚Šå¼·ã„å‡è¦–åŠ›ãŒå…‰ã‚Šã¾ã™ã€‚

[00:45]{ä¸‹ç©´,å‡è¦–} **ä¸‹ç©´ã‚’3ã¤å…ˆã¾ã§è¦‹æ®ãˆãŸç½®ãæ–¹**
ã“ã“ã§é€šå¸¸ãªã‚‰TãƒŸãƒã‚’å¹³ç©ã¿ã«ä½¿ã„ãŸããªã‚‹ã¨ã“ã‚ã§ã™ãŒã€ã‚ãˆã¦å³ç«¯ã«ç«‹ã¦ã¦ç½®ãã¾ã—ãŸã€‚ã“ã‚Œã¯3åˆ—ä¸‹ã«ã‚ã‚‹Garbage Holeï¼ˆç©´ï¼‰ãŒå³å´ã«ã‚ã‚‹ã“ã¨ã‚’è¦‹è¶Šã—ã¦ã®åˆ¤æ–­ã§ã™ã€‚ã“ã®ä¸€æ‰‹ãŒå¾Œã®ãƒ†ãƒˆãƒªã‚¹æ¶ˆã—ã«ç¹‹ãŒã‚Šã¾ã™ã€‚

[02:00]{ç›¸æ®ºå¤–ã—,ãƒªã‚½ãƒ¼ã‚¹} **ç›¸æ®ºå¤–ã—ã«ã‚ˆã‚‹æ„å›³çš„ãªãƒªã‚½ãƒ¼ã‚¹è“„ç©**
ç›¸æ‰‹ã‹ã‚‰ã®4ãƒ©ã‚¤ãƒ³æ”»æ’ƒã«å¯¾ã—ã€ã‚ãˆã¦ç›¸æ®ºã›ãšå—ã‘å…¥ã‚Œã¾ã—ãŸã€‚
è‡ªåˆ†ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä½ã„ãŸã‚ã€ã“ã“ã§ãƒ©ã‚¤ãƒ³ã‚’å—ã‘å…¥ã‚Œã¦ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®ç¨®ï¼ˆãƒªã‚½ãƒ¼ã‚¹ï¼‰ã«ã™ã‚‹é«˜åº¦ãªåˆ¤æ–­ã§ã™ã€‚

> **Point:** ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä½ã„æ™‚ã¯ã€å³åº§ã«ç›¸æ®ºã™ã‚‹ã‚ˆã‚Šã‚‚å—ã‘å…¥ã‚ŒãŸæ–¹ãŒç«åŠ›ãŒå‡ºã›ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

[04:15]{æ˜ã‚Š,åˆ¤æ–­} **IãƒŸãƒã‚’æ¸©å­˜ã—ãŸã¾ã¾æ˜ã‚‹**
éå¸¸ã«å±é™ºãªåœ°å½¢ã§ã™ãŒã€ãƒ›ãƒ¼ãƒ«ãƒ‰ã«ã‚ã‚‹IãƒŸãƒã‚’ä½¿ã‚ãšã«SãƒŸãƒã¨ZãƒŸãƒã ã‘ã§åœ°å½¢ã‚’æ•´ãˆã¾ã—ãŸã€‚ã€Œã“ã“ã§IãƒŸãƒã‚’ä½¿ã£ã¦ã—ã¾ã†ã¨ã€ãã®å¾Œã®ç«åŠ›ãŒå‡ºãªã„ã€ã¨ã„ã†å†·é™ãªåˆ¤æ–­ãŒè¦‹ã¦å–ã‚Œã¾ã™ã€‚

### ç·è©•
å…¨ä½“ã‚’é€šã—ã¦ã€ç›®å…ˆã®ãƒ©ã‚¤ãƒ³æ¶ˆå»ã‚ˆã‚Šã‚‚ã€Œ3æ‰‹å…ˆã®åœ°å½¢ã€ã‚’å„ªå…ˆã™ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ãŒå¾¹åº•ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
            `
        },
        {
            id: 'ren-practice-01',
            date: '2025-11-25',
            title: 'ä¸­é–‹ã‘RENã®åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³',
            youtubeId: 'M7lc1UVf-VE',
            tags: ['REN', 'ãƒ†ãƒ³ãƒ—ãƒ¬'],
            description: 'æ±ç”¨æ€§ã®é«˜ã„ä¸­é–‹ã‘RENã®ç©ã¿è¾¼ã¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ã€‚',
            content: `
RENï¼ˆé€£é–ï¼‰ã¯ç¾ä»£ãƒ†ãƒˆãƒªã‚¹ã«ãŠã„ã¦å¿…é ˆæŠ€è¡“ã§ã™ã€‚ç‰¹ã«ä¸­é–‹ã‘ã¯åœ°å½¢ã‚’é¸ã°ãšçµ„ã¿ã‚„ã™ã„ã®ãŒç‰¹å¾´ã§ã™ã€‚

[00:10]{åŸºç¤} **3åˆ—ç©ºã‘ã®åŸºæœ¬å½¢**
æœ€ã‚‚ã‚ªãƒ¼ã‚½ãƒ‰ãƒƒã‚¯ã‚¹ãªå½¢ã§ã™ã€‚å·¦å³ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã‚„ã™ãã€æš´ç™ºã—ã«ãã„ã®ãŒãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚

[01:25]{æ´¾ç”Ÿ} **S/ZãƒŸãƒãŒåã£ãŸå ´åˆã®å¯¾å‡¦**
Sã‚„Zã°ã‹ã‚Šæ¥ãŸå ´åˆã€ã“ã®ã‚ˆã†ã«ç„¡ç†ã‚„ã‚Šç«¯ã«å¯„ã›ã¦å¹³ã‚‰ã«ã™ã‚‹ã“ã¨ã§ã€å¾Œã®RENç¶™ç¶šç‡ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

[03:40]{ãƒªã‚«ãƒãƒªãƒ¼} **ãƒŸã‚¹ã‹ã‚‰ã®å¾©å¸°**
ç½®ããƒŸã‚¹ã‚’ã—ã¦ã—ã¾ã£ãŸç›´å¾Œã®ä¿®æ­£æ‰‹é †ã§ã™ã€‚Tã‚¹ãƒ”ãƒ³ã‚’ä½œã‚‹ã®ã§ã¯ãªãã€ä¸€åº¦ãƒ©ã‚¤ãƒ³ã‚’æ¶ˆã—ã¦æ•´åœ°ã™ã‚‹ã“ã¨ã«å°‚å¿µã—ã¦ã„ã¾ã™ã€‚
            `
        }
    ];

    // ãƒ€ãƒŸãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ã®ãŸã‚ï¼‰
    window.LAB_ARTICLES = window.LAB_ARTICLES || [
        { id: 'dummy-1', date: '2025-10-01', title: 'ãƒ†ãƒˆãƒªã‚¹ã®åŸºç¤çŸ¥è­˜', tags: ['åˆå¿ƒè€…'], content: 'ã“ã‚Œã¯ãƒ€ãƒŸãƒ¼è¨˜äº‹ã§ã™ã€‚', description: 'è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚' }
    ];
    window.LAB_TETOFU = window.LAB_TETOFU || [
        { url: 'https://example.com', date: '2025-09-15', title: 'é–‹å¹•TSD', tags: ['ãƒ†ãƒ³ãƒ—ãƒ¬'], notes: 'ã‚µãƒ³ãƒ—ãƒ«' }
    ];
</script>

<script src="data/articles.js" onerror="console.log('articles.js not found, using dummy')"></script>
<script src="data/videos.js" onerror="console.log('videos.js not found, using embedded')"></script>
<script src="data/tetofu.js" onerror="console.log('tetofu.js not found, using dummy')"></script>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
    const getArticles = () => (window.LAB_ARTICLES || []).sort((a,b) => new Date(b.date) - new Date(a.date));
    const getVideos = () => (window.LAB_VIDEOS || []).sort((a,b) => new Date(b.date) - new Date(a.date));
    const getTetofu = () => (window.LAB_TETOFU || []).sort((a,b) => new Date(b.date) - new Date(a.date));

    // YouTube APIé€£æºç”¨
    let ytPlayers = {};
    let isYTApiReady = false;
    function onYouTubeIframeAPIReady() { 
        isYTApiReady = true;
    }

    // ã‚¿ã‚°HTMLç”Ÿæˆ
    const createTagHtml = (tags) => (tags || []).map(t => `<span class="tag" onclick="event.preventDefault(); event.stopPropagation(); router('tags', '${t}')">${t}</span>`).join('');

    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æŠ½å‡ºç”¨æ­£è¦è¡¨ç¾
    const TS_REGEX = /\[(\d{1,2}):(\d{2})\](?:\{([^}]+)\})?/g;
    const TS_LINE_REGEX = /^\[(\d{1,2}):(\d{2})\](?:\{([^}]+)\})?\s*(.*)$/gm;

    // --- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ---
    const mainView = document.getElementById('main-view');
    function router(page, id = null, query = null) {
        let targetHash = page;
        if (id) targetHash += `/${id}`;
        if (query) targetHash += `?q=${encodeURIComponent(query)}`;

        // ã€ä¿®æ­£ã€‘æ¤œç´¢æ™‚ãªã©ãƒãƒƒã‚·ãƒ¥ãŒåŒã˜ã§ã‚‚å¼·åˆ¶çš„ã«å†æç”»ã•ã›ã‚‹ãŸã‚ã€return ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        if (decodeURIComponent(location.hash) !== '#' + targetHash) {
            location.hash = targetHash;
            // ãƒãƒƒã‚·ãƒ¥å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã§å†åº¦å‘¼ã°ã‚Œã‚‹ã®ã§ã€ã“ã“ã§ã¯ä¸€æ—¦çµ‚äº†ã—ã¦ã‚‚ã‚ˆã„ãŒ
            // æ˜ç¤ºçš„ãªå‘¼ã³å‡ºã—ã«å¯¾å¿œã™ã‚‹ãŸã‚ç¶šè¡Œã•ã›ã‚‹ã€ã¾ãŸã¯ã‚¤ãƒ™ãƒ³ãƒˆã«ä»»ã›ã‚‹è¨­è¨ˆã€‚
            // ã“ã“ã§ã¯å®‰å…¨ã®ãŸã‚ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã«ä»»ã›ã¦çµ‚äº†ã™ã‚‹ï¼ˆäºŒé‡æç”»é˜²æ­¢ï¼‰
            return;
        }

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const activeTab = document.querySelector(`.nav-item[onclick="router('${page}')"]`);
        if(activeTab) activeTab.classList.add('active');

        mainView.innerHTML = '';
        window.scrollTo({top: 0, behavior: 'smooth'});

        // å¤ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‚ç…§ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢ã®ãŸã‚ç°¡æ˜“çš„ã«ï¼‰
        ytPlayers = {};

        switch(page) {
            case 'dashboard': renderDashboard(); break;
            case 'articles': id ? renderArticleDetail(id) : renderArticleList(); break;
            case 'videos': id ? renderVideoDetail(id) : renderVideoList(); break;
            case 'tetofu': renderTetofu(); break;
            case 'tags': id ? renderTagDetail(id) : renderTagList(); break;
            case 'search': renderSearchResults(query); break;
        }
    }

    // --- æ¤œç´¢æ©Ÿèƒ½ (ä¿®æ­£ç‰ˆ) ---
    function handleSearch(e) {
        if(e.key === 'Enter') {
            e.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãªã©ã‚’é˜²æ­¢
            const query = e.target.value.trim();
            if(query) {
                // ãƒãƒƒã‚·ãƒ¥ã‚’æ›¸ãæ›ãˆã‚‹ã€‚ã“ã‚ŒãŒ hashchange ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã€router('search', null, query) ãŒå‘¼ã°ã‚Œã‚‹
                location.hash = `search?q=${encodeURIComponent(query)}`;
            }
        }
    }

    function renderSearchResults(query) {
        if(!query) return router('dashboard');

        mainView.innerHTML = `
            <button class="btn-outline" onclick="router('dashboard')" style="margin-bottom: 24px;">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            <h2 class="section-title">æ¤œç´¢çµæœ: "${decodeURIComponent(query)}"</h2>
            <div class="list-container" id="search-results"></div>
        `;
        const list = document.getElementById('search-results');
        const q = decodeURIComponent(query).toLowerCase();

        const results = [];
        // 1. Articles
        getArticles().forEach(a => {
            if(a.title.toLowerCase().includes(q) || a.content.toLowerCase().includes(q) || (a.tags||[]).some(t=>t.toLowerCase().includes(q))) {
                results.push({...a, type: 'è¨˜äº‹', action: () => router('articles', a.id)});
            }
        });
        // 2. Videos
        getVideos().forEach(v => {
            if(v.title.toLowerCase().includes(q) || v.content.toLowerCase().includes(q) || (v.tags||[]).some(t=>t.toLowerCase().includes(q))) {
                results.push({...v, type: 'å‹•ç”»', action: () => router('videos', v.id)});
            }
        });
        // 3. Tetofu
        getTetofu().forEach(t => {
            if(t.title.toLowerCase().includes(q) || (t.notes||'').toLowerCase().includes(q) || (t.tags||[]).some(t=>t.toLowerCase().includes(q))) {
                results.push({...t, type: 'ãƒ†ãƒˆè­œ', action: () => window.open(t.url, '_blank')});
            }
        });

        if(results.length === 0) {
            list.innerHTML = `<div style="color:var(--text-muted);">è©²å½“ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>`;
            return;
        }

        results.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(item => {
            renderCard(list, item);
        });
    }

    // --- UI ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° (å…±é€šã‚«ãƒ¼ãƒ‰ç”Ÿæˆ) ---
    function renderCard(container, item, highlightTag = null) {
        const card = document.createElement('div');
        card.className = 'card';
        
        // å‹•ç”»ã®å ´åˆã€ã‚¿ã‚¤ãƒˆãƒ«ã‚¯ãƒªãƒƒã‚¯ã§é·ç§»ã€ãã®ä»–ã¯å…¨ä½“ã‚¯ãƒªãƒƒã‚¯
        // â€»å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼éƒ¨åˆ†ã¯ã‚¯ãƒªãƒƒã‚¯ã§é·ç§»ã—ãªã„ã‚ˆã†ã«åˆ¶å¾¡
        if(item.type !== 'å‹•ç”»') {
            card.onclick = item.externalUrl ? () => window.open(item.externalUrl, '_blank') : item.action;
        }

        // å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯IDç”Ÿæˆ
        const uniqueSuffix = Math.random().toString(36).substring(7);
        const playerId = item.type === 'å‹•ç”»' ? `yt-card-${item.id}-${uniqueSuffix}` : null;

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã«å‹•ç”»ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ½å‡º
        let tsPreview = '';
        if (item.type === 'å‹•ç”»' && item.content) {
            const matches = [...item.content.matchAll(TS_LINE_REGEX)];
            if(matches.length > 0) {
                tsPreview = `<div class="preview-ts-list">`;
                let count = 0;
                matches.forEach(m => {
                    const [full, min, sec, tagsRaw, desc] = m;
                    const tags = tagsRaw ? tagsRaw.split(',').map(t=>t.trim()) : [];
                    
                    if (highlightTag && !tags.includes(highlightTag)) return;
                    if (!highlightTag && count >= 3) return;

                    const timeSec = parseInt(min)*60 + parseInt(sec);
                    const timeStr = `${min}:${sec}`;
                    
                    // ã€ä¿®æ­£ã€‘onclickã§ã“ã®ã‚«ãƒ¼ãƒ‰ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚·ãƒ¼ã‚¯ã•ã›ã‚‹ (stopPropagationã§è¦ªã®é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã‚‹)
                    tsPreview += `
                        <div class="preview-ts-item" onclick="event.stopPropagation(); seekVideo('${playerId}', ${timeSec})">
                            <span class="ts-badge">â–¶ ${timeStr}</span>
                            <span>${desc.substring(0, 40)}${desc.length>40?'...':''}</span>
                        </div>`;
                    count++;
                });
                tsPreview += `</div>`;
            }
        }

        // å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åŸ‹ã‚è¾¼ã¿ (Iframe APIä½¿ç”¨)
        let videoEmbed = '';
        if (item.type === 'å‹•ç”»' && item.youtubeId) {
            videoEmbed = `
            <div class="video-wrapper" style="margin-bottom:16px;">
                <div id="${playerId}"></div>
            </div>`;
        }

        // ã€ä¿®æ­£ã€‘ã‚¿ã‚¤ãƒˆãƒ«è‰²: link-colorã®æŒ‡å®šã‚’å‰Šé™¤
        const titleHtml = item.type === 'å‹•ç”»' 
            ? `<div class="card-title" onclick="router('videos', '${item.id}')" style="cursor:pointer;">${item.title}</div>`
            : `<div class="card-title">${item.title}</div>`;

        card.innerHTML = `
            <div class="card-meta">
                <span style="font-weight:bold; color:var(--accent-color);">${item.type || 'Note'}</span> 
                <span>${item.date}</span>
                ${item.externalUrl ? '<span style="color:var(--text-muted)">å¤–éƒ¨ãƒªãƒ³ã‚¯ â†—</span>' : ''}
            </div>
            ${videoEmbed}
            ${titleHtml}
            ${item.description ? `<div class="card-desc">${item.description}</div>` : ''}
            <div>${createTagHtml(item.tags)}</div>
            ${tsPreview}
        `;
        container.appendChild(card);

        // YouTubeãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸåŒ– (DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œ)
        if (item.type === 'å‹•ç”»' && item.youtubeId && playerId) {
            // APIãƒ­ãƒ¼ãƒ‰å¾…ã¡ã‚’å«ã‚ãŸåˆæœŸåŒ–å‡¦ç†
            const initPlayer = () => {
                if (window.YT && window.YT.Player) {
                    ytPlayers[playerId] = new YT.Player(playerId, {
                        videoId: item.youtubeId,
                        playerVars: { 'rel': 0 },
                        height: '100%',
                        width: '100%'
                    });
                } else {
                    setTimeout(initPlayer, 200);
                }
            };
            // å°‘ã—é…ã‚‰ã›ã¦å®Ÿè¡Œï¼ˆDOMæç”»ç¢ºå®ŸåŒ–ï¼‰
            setTimeout(initPlayer, 50);
        }
    }

    // 1. DASHBOARD
    function renderDashboard() {
        mainView.innerHTML = `
            <h2 class="section-title">æœ€æ–°ã®ãƒãƒ¼ãƒˆ</h2>
            <div class="list-container" id="dash-list"></div>
            
            <h2 class="section-title" style="margin-top: 60px;">ãƒ„ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯</h2>
            <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                <a href="https://selmtoe.github.io/Tetris_Simulator/" target="_blank" class="btn-outline">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’é–‹ã â†—</a>
                <a href="https://selmtoe.github.io/Tetris_Simulator/F/index.html" target="_blank" class="btn-outline">è­œé¢ã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã â†—</a>
            </div>
        `;
        const list = document.getElementById('dash-list');
        
        const recent = [
            ...getArticles().slice(0, 3).map(i => ({...i, type: 'è¨˜äº‹', action: () => router('articles', i.id)})),
            ...getVideos().slice(0, 3).map(i => ({...i, type: 'å‹•ç”»', action: () => router('videos', i.id)})),
            ...getTetofu().slice(0, 2).map(i => ({...i, type: 'ãƒ†ãƒˆè­œ', action: () => window.open(i.url, '_blank')}))
        ].sort((a,b) => new Date(b.date) - new Date(a.date));

        recent.forEach(item => renderCard(list, item));
    }

    // 2. ARTICLES (List)
    function renderArticleList() {
        mainView.innerHTML = `<h2 class="section-title">è¨˜äº‹ä¸€è¦§</h2><div class="list-container" id="article-list"></div>`;
        const list = document.getElementById('article-list');
        getArticles().forEach(a => {
            renderCard(list, {...a, type: 'è¨˜äº‹', action: () => router('articles', a.id)});
        });
    }

    // 3. ARTICLE DETAIL
    function renderArticleDetail(id) {
        const article = getArticles().find(a => a.id === id);
        if(!article) return router('articles');

        let html = `
            <div class="article-header">
                <button class="btn-outline" onclick="router('articles')" style="margin-bottom: 24px;">â† è¨˜äº‹ä¸€è¦§ã«æˆ»ã‚‹</button>
                <div class="card-meta">${article.date}</div>
                <h1 class="article-title">${article.title}</h1>
                <div>${createTagHtml(article.tags)}</div>
            </div>
            <div class="article-body">${marked.parse(article.content)}</div>
        `;
        mainView.innerHTML = html;
    }

    // 4. VIDEOS (List)
    function renderVideoList() {
        mainView.innerHTML = `<h2 class="section-title">å‹•ç”»ç ”ç©¶</h2><div class="list-container" id="video-list"></div>`;
        const list = document.getElementById('video-list');
        getVideos().forEach(v => {
            renderCard(list, {...v, type: 'å‹•ç”»', action: () => router('videos', v.id)});
        });
    }

    // 4-2. VIDEO DETAIL
    function renderVideoDetail(id) {
        const v = getVideos().find(video => video.id === id);
        if(!v) return router('videos');

        // å¤ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’ã‚¯ãƒªã‚¢
        const playerId = `yt-player-detail`;
        
        // Markdownå†…ã® [mm:ss]{tag} ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªHTMLã«å¤‰æ›
        const rawContent = v.content || "";
        const processedContent = rawContent.replace(TS_REGEX, (match, min, sec, tagsRaw) => {
            const time = parseInt(min) * 60 + parseInt(sec);
            const timeStr = `${min}:${sec}`;
            let tagHtml = '';
            if(tagsRaw) {
                tagHtml = tagsRaw.split(',').map(t => `<span class="tag" style="margin-left:4px; font-size:11px; padding:1px 6px;">${t.trim()}</span>`).join('');
            }
            return `<a class="ts-link" onclick="seekVideo('${playerId}', ${time})">â–¶ ${timeStr}</a>${tagHtml}`;
        });

        const html = `
            <button class="btn-outline" onclick="router('videos')" style="margin-bottom: 24px;">â† å‹•ç”»ä¸€è¦§ã«æˆ»ã‚‹</button>
            
            <div class="video-detail-container">
                <div class="video-sticky-area">
                    <div class="video-wrapper">
                        <div id="${playerId}"></div>
                    </div>
                    <div class="video-controls">
                        <button class="rate-btn" onclick="changeRate('${playerId}', 0.25)">x0.25</button>
                        <button class="rate-btn" onclick="changeRate('${playerId}', 0.5)">x0.5</button>
                        <button class="rate-btn active" onclick="changeRate('${playerId}', 1.0)">x1.0</button>
                        <button class="rate-btn" onclick="changeRate('${playerId}', 1.5)">x1.5</button>
                    </div>
                    
                    <h1 class="article-title" style="font-size:24px;">${v.title}</h1>
                    <div class="card-meta">${v.date}</div>
                    <div>${createTagHtml(v.tags)}</div>
                </div>

                <div class="article-body">
                    ${marked.parse(processedContent)}
                </div>
            </div>
        `;
        mainView.innerHTML = html;

        const initYT = () => {
            if (window.YT && YT.Player) {
                ytPlayers[playerId] = new YT.Player(playerId, {
                    videoId: v.youtubeId,
                    playerVars: { 'rel': 0 }
                });
            } else {
                setTimeout(initYT, 100);
            }
        };
        initYT();
    }

    // å‹•ç”»æ“ä½œé–¢æ•°
    window.seekVideo = function(playerId, seconds) {
        const player = ytPlayers[playerId];
        if (player && typeof player.seekTo === 'function') {
            player.seekTo(seconds, true);
            player.playVideo();
        } else {
            console.warn("Player not found or not ready:", playerId);
        }
    }
    
    window.changeRate = function(playerId, rate) {
        const player = ytPlayers[playerId];
        if (player && typeof player.setPlaybackRate === 'function') {
            player.setPlaybackRate(rate);
            const container = document.querySelector('.video-controls');
            if(container) {
                container.querySelectorAll('.rate-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.innerText.includes(rate));
                });
            }
        }
    }

    // 5. TETOFU
    function renderTetofu() {
        mainView.innerHTML = `<h2 class="section-title">ãƒ†ãƒˆè­œãƒ»ç›¤é¢ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h2><div class="list-container" id="tetofu-list"></div>`;
        const list = document.getElementById('tetofu-list');
        getTetofu().forEach(t => {
            renderCard(list, {...t, type: 'ãƒ†ãƒˆè­œ', action: () => window.open(t.url, '_blank')});
        });
    }

    // 6. TAGS
    function renderTagList() {
        mainView.innerHTML = `<h2 class="section-title">ã‚¿ã‚°ä¸€è¦§</h2><div class="list-container" style="flex-direction:row; flex-wrap:wrap;" id="tag-cloud"></div>`;
        const container = document.getElementById('tag-cloud');
        
        const allTags = {};
        const collect = (tags) => (tags||[]).forEach(t => allTags[t] = (allTags[t] || 0) + 1);

        getArticles().forEach(i => collect(i.tags));
        getTetofu().forEach(i => collect(i.tags));
        
        getVideos().forEach(v => {
            collect(v.tags);
            const matches = [...v.content.matchAll(TS_REGEX)];
            matches.forEach(m => {
                if(m[3]) m[3].split(',').forEach(t => allTags[t.trim()] = (allTags[t.trim()] || 0) + 1);
            });
        });

        Object.entries(allTags).sort((a,b) => b[1] - a[1]).forEach(([tag, count]) => {
            const el = document.createElement('span');
            el.className = 'tag';
            el.style.fontSize = '14px'; el.style.padding = '6px 14px';
            el.innerHTML = `${tag} (${count})`;
            el.onclick = () => router('tags', tag);
            container.appendChild(el);
        });
    }

    function renderTagDetail(tagName) {
        const decodedTag = decodeURIComponent(tagName);
        mainView.innerHTML = `
            <button class="btn-outline" onclick="router('tags')" style="margin-bottom: 24px;">â† ã‚¿ã‚°ä¸€è¦§ã«æˆ»ã‚‹</button>
            <h2 class="section-title">ã‚¿ã‚°: ${decodedTag}</h2>
            <div class="list-container" id="tag-results"></div>
        `;
        const list = document.getElementById('tag-results');

        const results = [
            ...getArticles().filter(a => (a.tags || []).includes(decodedTag)).map(i => ({...i, type: 'è¨˜äº‹', action: () => router('articles', i.id)})),
            ...getTetofu().filter(t => (t.tags || []).includes(decodedTag)).map(i => ({...i, type: 'ãƒ†ãƒˆè­œ', action: () => window.open(i.url, '_blank')})),
            ...getVideos().filter(v => {
                const hasMainTag = (v.tags || []).includes(decodedTag);
                const hasContentTag = v.content.includes(`{${decodedTag}}`) || v.content.includes(`,${decodedTag}}`) || v.content.includes(`{${decodedTag},`);
                return hasMainTag || hasContentTag;
            }).map(i => ({...i, type: 'å‹•ç”»', action: () => router('videos', i.id)}))
        ].sort((a,b) => new Date(b.date) - new Date(a.date));

        if(results.length === 0) {
            list.innerHTML = `<div style="color:var(--text-muted);">è©²å½“ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
            return;
        }

        results.forEach(item => {
            renderCard(list, item, decodedTag);
        });
    }

    // åˆæœŸåŒ–
    window.addEventListener('hashchange', () => {
        const hash = decodeURIComponent(location.hash.slice(1));
        const [path, queryPart] = hash.split('?');
        const [page, id] = path.split('/');
        
        let query = null;
        if(queryPart) {
            const params = new URLSearchParams(queryPart);
            query = params.get('q');
        }
        router(page || 'dashboard', id, query);
    });

    setTimeout(() => {
        if(!location.hash) router('dashboard');
        else window.dispatchEvent(new HashChangeEvent("hashchange"));
    }, 100);
</script>
</body>
</html>
